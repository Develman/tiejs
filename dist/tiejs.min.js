/*!
TieJS - http://develman.github.io/tiejs
Licensed under the MIT license
*/
(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function(e){"use strict";var t=function(t,n){function u(){if(o.formName){i.attr("name",o.formName)}if(o.showRequiredAsterisk){var t=e("<p class='required-info'>Mit <span class='required-sign'>*</span> markierte Felder sind Pflichtfelder</p>");i.prepend(t)}i.addClass("tiejs-form");i.on("submit",function(e){e.preventDefault();if(c(i,s)){o.onSubmit()}})}function b(t){t.find("div.alert").remove();t.find(".form-group").each(function(t,n){e(n).removeClass("has-error has-feedback");e(n).find(".form-control-feedback").remove()})}function w(t,n){var r=e(t).attr(n);return typeof r!=="undefined"&&r!==false}function E(t){var n=e("<div></div>");n.addClass("alert alert-danger");n.text("Bitte beheben Sie die im Formular hervorgehobenen Fehler");t.prepend(n)}function S(e){var t=e.parent();if(t.hasClass("input-group")){t=t.parent()}t.addClass("has-error has-feedback");if(e.is("select")){t.append("<span class='fa fa-times form-control-feedback feedback-select'></span>")}else{t.append("<span class='fa fa-times form-control-feedback'></span>")}}function x(e,t,n){var r=e.attr("type");switch(r){case"checkbox":var i=t[n];if(i==0){e.prop("checked",false)}else{e.prop("checked",true)}break;case"radio":e.val([t[n]]);break;default:var s=t[n];e.val(s)}}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r.name===e){return r}}return null}var r=e(this);var i=e(t);var s=[];var o=e.extend({showRequiredAsterisk:true,formName:null,bindingSource:{},onSubmit:function(){}},n);u();this.addFields=function(t){e.each(t,function(e,t){if(t.data){i.append(a(t.type,t.data));if(T(t.data.name,s)===null){s.push({name:t.data.name,binding:""})}}});return this};this.addColumns=function(e){if(e.length>0){i.append(f(e,s))}return this};this.addBindings=function(t){if(o.bindingSource){e.each(t,function(t,n){e.each(n,function(e,t){l(i,o.bindingSource,e,t);var n=T(e,s);n.binding=t})})}return this};this.captureFields=function(){i.find(".form-control").each(function(t,n){var r=e(n).attr("name");if(T(r,s)===null){s.push({name:r,binding:""})}});return this};this.updateSettings=function(t){e.extend(o,t);this.reload()};this.reload=function(){b(i);e.each(s,function(e,t){l(i,o.bindingSource,t.name,t.binding)})};this.markFieldError=function(t){e.each(t,function(e,t){var n=i.find("[name="+t+"]");S(n)})};var a=function(e,t){var n=null;switch(e){case"text":case"number":case"time":case"date":case"email":case"password":n=h(e,t);break;case"checkbox":n=p(t);break;case"radio":n=d(t);break;case"select":n=v(t);break;case"color":n=m(t);break;case"longtext":n=g(t);break;case"button":n=y(t);break}return n};var f=function(t,n){var r=e("<div></div>");r.addClass("row");e.each(t,function(t,i){var s=e("<div></div>");s.addClass("col-md-6");if(i.data){s.append(a(i.type,i.data));if(T(i.data.name,n)===null){n.push({name:i.data.name,binding:""})}}r.append(s)});return r};var l=function(e,t,n,r){var i=e.find("[name="+n+"]");if(i&&typeof t[r]!=="undefined"){var s=i.attr("type");if(i.is("select")){s="select"}i.on("change",function(){switch(s){case"checkbox":var o=i.is(":checked")?1:0;t[r]=o;break;case"radio":var o=e.find("input[name="+n+"]:checked").val();t[r]=o;break;case"select":var o=e.find("select[name="+n+"] option:selected").val();t[r]=o;break;default:t[r]=i.val()}});x(i,t,r)}};var c=function(t,n){b(t);var r=true;e.each(n,function(n,i){var s=t.find("[name="+i.name+"]");var o=s.val();if(w(s,"required")){if(!o||s.is("select")&&o=="0"){r=false;S(s)}}var u=s.attr("type");switch(u){case"number":if(o&&!e.isNumeric(o)){r=false;S(s)}break;case"email":var a=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(o&&!a.test(o)){r=false;S(s)}break}});if(!r){E(t)}return r};var h=function(t,n){var r=e("<div></div>");r.addClass("form-group");var i=n.label;if(o.showRequiredAsterisk&&n.required){i+="<span class='required-sign'>*</span>"}r.append("<label class='control-label'>"+i+":</label>");var s="<input type='"+t+"' name='"+n.name+"' class='form-control'";if(n.css){s=s.slice(0,-1);s+=" "+n.css+"'"}if(n.placeholder){s+=" placeholder='"+n.placeholder+"'"}if(n.attributes){s+=" "+n.attributes}if(n.required){s+=" required"}s+=" />";r.append(s);return r};var p=function(t){var n=e("<div></div>");n.addClass("checkbox");var r=e("<label></label>");r.addClass("control-label");var i="<input type='checkbox' name='"+t.name+"'";if(t.css){i+=" class='"+t.css+"'"}if(t.attributes){i+=" "+t.attributes}if(t.required){i+=" required"}i+=" />";r.append(i);var s=t.label;if(o.showRequiredAsterisk&&t.required){s+="<span class='required-sign'>*</span>"}r.append(s);n.append(r);return n};var d=function(t){var n=e("<div></div>");n.addClass("radio");var r=e("<label></label>");r.addClass("control-label");var i="<input type='radio' name='"+t.name+"'";if(t.css){i+=" class='"+t.css+"'"}if(t.attributes){i+=" "+t.attributes}if(t.required){i+=" required"}i+=" />";r.append(i);var s=t.label;if(o.showRequiredAsterisk&&t.required){s+="<span class='required-sign'>*</span>"}r.append(s);n.append(r);return n};var v=function(t){var n=e("<div></div>");n.addClass("form-group");var r=t.label;if(o.showRequiredAsterisk&&t.required){r+="<span class='required-sign'>*</span>"}n.append("<label class='control-label'>"+r+":</label>");var i="<select name='"+t.name+"' class='form-control'";if(t.css){i=input.slice(0,-1);i+=" "+t.css+"'"}if(t.attributes){i+=" "+t.attributes}if(t.required){i+=" required"}i+=">";if(t.placeholder){i+="<option value='0' disabled selected>"+t.placeholder+"</option>"}if(t.options){e.each(t.options,function(e,t){i+="<option value='"+t.id+"'>"+t.name+"</option>"})}i+="</select>";n.append(i);return n};var m=function(t){var n=e("<div></div>");n.addClass("form-group");var r=t.label;if(o.showRequiredAsterisk&&t.required){r+="<span class='required-sign'>*</span>"}n.append("<label class='control-label'>"+r+":</label>");var i=e("<div></div>");i.addClass("input-group colorpicker");var s="<input type='text' name='"+t.name+"' class='form-control'";if(t.css){s=s.slice(0,-1);s+=" "+t.css+"'"}if(t.placeholder){s+=" placeholder='"+t.placeholder+"'"}if(t.attributes){s+=" "+t.attributes}if(t.required){s+=" required"}s+=" />";var u=e("<span></span>");u.addClass("input-group-addon");u.html("<i></i>");i.append(s);i.append(u);n.append(i);return n};var g=function(t){var n=e("<div></div>");n.addClass("form-group");var r=t.label;if(o.showRequiredAsterisk&&t.required){r+="<span class='required-sign'>*</span>"}n.append("<label class='control-label'>"+r+":</label>");var i="<textarea name='"+t.name+"' class='form-control'";if(t.css){i=i.slice(0,-1);i+=" "+t.css+"'"}if(t.placeholder){i+=" placeholder='"+t.placeholder+"'"}if(t.attributes){i+=" "+t.attributes}if(t.required){i+=" required"}i+="></textarea>";n.append(i);return n};var y=function(t){var n=e("<div></div>");n.addClass("form-group");var r="<button type='button' class='btn btn-default'";if(t.css){r=r.slice(0,-1);r+=" "+t.css+"'"}r+=">"+t.label+"</button>";n.append(r);return n}};e.fn.TieJS=function(n){return this.each(function(){var r=e(this);if(r.data("tiejs")){return}r.data("tiejs",new t(this,n))})}})