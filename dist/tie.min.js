/*!
 TieJS - http://develman.github.io/tiejs
 Licensed under the MIT license
 Copyright (c) 2014 Georg Henkel <georg@develman.de>, Christoph Huppertz <huppertz.chr@gmail.com>
 */
(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function($){"use strict";var TieJS=function(form,options){function _initForm(){if(settings.formName){$form.attr("name",settings.formName)}if(settings.showRequiredAsterisk){var e=$("<p class='required-info'>Mit <span class='required-sign'>*</span> markierte Felder sind Pflichtfelder</p>");$form.prepend(e)}$form.addClass("tiejs-form");$form.one("submit",function(e){e.preventDefault();if(_validate($form,fieldNames)){settings.onSubmit($form)}})}function _clearMarker(e){e.find("div.alert").remove();e.find(".form-group").each(function(e,t){$(t).removeClass("has-error has-feedback");$(t).find(".form-control-feedback").remove()})}function _hasAttribute(e,t){var n=$(e).attr(t);return typeof n!=="undefined"&&n!==false}function _addFormError(e,t){var n=$(".formerror");if(n.length==0){n=$("<div></div>");n.addClass("formerror alert alert-danger");e.prepend(n)}if(t===undefined){n.text("Bitte beheben Sie die im Formular hervorgehobenen Fehler")}else{n.text(t)}}function _addFieldError(e){var t=e.parent();if(t.hasClass("input-group")){t=t.parent()}t.addClass("has-error has-feedback");if(e.is("select")){t.append("<span class='fa fa-times form-control-feedback feedback-select'></span>")}else{t.append("<span class='fa fa-times form-control-feedback'></span>")}}function _updateFieldData(e,t,n){var r=e.attr("type");switch(r){case"checkbox":var i=t[n];if(i==0){e.prop("checked",false)}else{e.prop("checked",true)}break;case"radio":e.val([t[n]]);break;case"select":if(!$(e).hasClass("tags")){var s=e.find("option");s.each(function(r){if($(s[r]).attr("data-type")===t[n]){e.val($(s[r]).val())}})}else{var o=new Array;t[n].forEach(function(e){o.push(e.id)});e.val(o)}break;default:var u=t[n];e.val(u)}}function _findInArray(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r.name===e){return r}}return null}var self=$(this);var $form=$(form);var fieldNames=[];var settings=$.extend({showRequiredAsterisk:true,formName:null,bindingSource:{},onSubmit:function(){}},options);_initForm();this.addFields=function(e){$.each(e,function(e,t){if(t.data){$form.append(_addField(t.type,t.data));if(_findInArray(t.data.name,fieldNames)===null){fieldNames.push({name:t.data.name,binding:""})}}});return this};this.addColumns=function(e){if(e.length>0){$form.append(_addColumns(e,fieldNames))}return this};this.addBindings=function(bindings){if(settings.bindingSource){$.each(bindings,function(index,binding){$.each(binding,function(fieldName,property){var binding=settings.bindingSource;if(property.indexOf(".")!=-1){var lastPointIdx=property.lastIndexOf(".");var namespace=property.substr(0,lastPointIdx);property=property.substr(lastPointIdx+1);var tmp="settings.bindingSource."+namespace;binding=eval(tmp)}_bind($form,binding,fieldName,property);var fieldNameData=_findInArray(fieldName,fieldNames);fieldNameData.binding=property})})}return this};this.captureFields=function(){$form.find(":input:not(:button)").each(function(e,t){var n=$(t).attr("name");if(_findInArray(n,fieldNames)===null){fieldNames.push({name:n,binding:""})}});return this};this.updateSettings=function(e){$.extend(settings,e);this.reload()};this.reload=function(){_clearMarker($form);$.each(fieldNames,function(e,t){_bind($form,settings.bindingSource,t.name,t.binding)})};this.markFieldError=function(e,t){$.each(e,function(e,t){var n=$form.find("[name="+t+"]");_addFieldError(n)});_addFormError($form,t)};var _addField=function(e,t){var n=null;switch(e){case"text":case"number":case"email":case"password":case"regex":n=_defaultField(e,t);break;case"checkbox":n=_checkboxField(t);break;case"radio":n=_radioField(t);break;case"select":n=_selectField(t,false);break;case"tags":n=_selectField(t,true);break;case"color":n=_colorField(t);break;case"date":n=_dateField(t);break;case"time":n=_timeField(t);break;case"longtext":n=_textareaField(t);break;case"wysiwyg":n=_wysiwygField(t);break;case"button":n=_button(t);break}return n};var _addColumns=function(e,t){var n=$("<div></div>");n.addClass("row");$.each(e,function(e,r){var i=$("<div></div>");i.addClass("col-md-6");if(r.data){i.append(_addField(r.type,r.data));if(_findInArray(r.data.name,t)===null){t.push({name:r.data.name,binding:""})}}n.append(i)});return n};var _bind=function(e,t,n,r){var i=e.find("[name="+n+"]");if(i&&typeof t[r]!=="undefined"){if(i.is("select")){i.attr("type","select")}var s=i.attr("type");e.on("change",i,function(o,u){if(i.attr("name")===$(o.target).attr("name")){switch(s){case"checkbox":var a=i.is(":checked")?1:0;t[r]=a;break;case"radio":var a=e.find("input[name="+n+"]:checked").val();t[r]=a;break;case"select":if(!$(o.target).hasClass("tags")){var a=e.find("select[name="+n+"] option:selected").val();t[r]=a}break;default:t[r]=i.val()}}});_updateFieldData(i,t,r)}};var _validate=function(e,t){_clearMarker(e);var n=true;$.each(t,function(t,r){var i=e.find("[name="+r.name+"]");var s=i.val();if(_hasAttribute(i,"required")){if(!s||i.is("select")&&s=="0"){n=false;_addFieldError(i)}}var o=i.attr("type");switch(o){case"number":if(s&&!$.isNumeric(s)){n=false;_addFieldError(i)}break;case"email":var u=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(s&&!u.test(s)){n=false;_addFieldError(i)}break}var a=i.attr("data-regex");if(a){var u=new RegExp(a);if(s&&!u.test(s)){n=false;_addFieldError(i)}}});if(!n){_addFormError(e)}return n};var _defaultField=function(e,t){var n=$("<div></div>");n.addClass("form-group");var r=t.label;if(settings.showRequiredAsterisk&&t.required){r+="<span class='required-sign'>*</span>"}n.append("<label class='control-label'>"+r+":</label>");var i="<input type='"+e+"' name='"+t.name+"' class='form-control'";if(t.css){i=i.slice(0,-1);i+=" "+t.css+"'"}if(t.placeholder){i+=" placeholder='"+t.placeholder+"'"}if(t.attributes){i+=" "+t.attributes}if(t.required){i+=" required"}if(t.regex){i+=" data-regex='"+t.regex+"'"}i+=" />";n.append(i);return n};var _checkboxField=function(e){var t=$("<div></div>");t.addClass("checkbox");var n=$("<label></label>");n.addClass("control-label");var r="<input type='checkbox' name='"+e.name+"'";if(e.css){r+=" class='"+e.css+"'"}if(e.attributes){r+=" "+e.attributes}if(e.required){r+=" required"}r+=" />";n.append(r);var i=e.label;if(settings.showRequiredAsterisk&&e.required){i+="<span class='required-sign'>*</span>"}n.append(i);t.append(n);return t};var _radioField=function(e){var t=$("<div></div>");t.addClass("radio");var n=$("<label></label>");n.addClass("control-label");var r="<input type='radio' name='"+e.name+"'";if(e.css){r+=" class='"+e.css+"'"}if(e.attributes){r+=" "+e.attributes}if(e.required){r+=" required"}r+=" />";n.append(r);var i=e.label;if(settings.showRequiredAsterisk&&e.required){i+="<span class='required-sign'>*</span>"}n.append(i);t.append(n);return t};var _selectField=function(e,t){var n=$("<div></div>");n.addClass("form-group");var r=e.label;if(settings.showRequiredAsterisk&&e.required){r+="<span class='required-sign'>*</span>"}var i="'form-control'";if(t){i="'form-control tags chosen-select' multiple";if(e.placeholder)i+=" data-placeholder='"+e.placeholder+"'"}n.append("<label class='control-label'>"+r+":</label>");var s="<select name='"+e.name+"' class="+i;if(e.css){s=input.slice(0,-1);s+=" "+e.css+"'"}if(e.attributes){s+=" "+e.attributes}if(e.required){s+=" required"}s+=">";if(e.placeholder&&!t){s+="<option value='0' disabled selected>"+e.placeholder+"</option>"}if(e.options){$.each(e.options,function(e,t){s+="<option value='"+t.id+"' data-type='"+t.type+"'>"+t.name+"</option>"})}if(e.url){$.ajax({type:"GET",url:e.url,async:false,success:function(e,t){var n=JSON.parse(e);n.forEach(function(e){s+="<option value='"+e.Id+"' data-type='"+e.Type+"'>"+e.Name+"</option>"})},error:function(e,t){if(console)console.log("tiejs: error loading select options from server, status: "+t)}})}s+="</select>";n.append(s);return n};var _colorField=function(e){var t=$("<div></div>");t.addClass("form-group");var n=e.label;if(settings.showRequiredAsterisk&&e.required){n+="<span class='required-sign'>*</span>"}t.append("<label class='control-label'>"+n+":</label>");var r=$("<div></div>");r.addClass("input-group color");var i="<input type='text' name='"+e.name+"' class='form-control'";if(e.css){i=i.slice(0,-1);i+=" "+e.css+"'"}if(e.placeholder){i+=" placeholder='"+e.placeholder+"'"}if(e.attributes){i+=" "+e.attributes}if(e.required){i+=" required"}i+=" />";var s=$("<span></span>");s.addClass("input-group-addon");s.html("<i></i>");r.append(i);r.append(s);t.append(r);return t};var _dateField=function(e){var t=$("<div></div>");t.addClass("form-group");var n=e.label;if(settings.showRequiredAsterisk&&e.required){n+="<span class='required-sign'>*</span>"}t.append("<label class='control-label'>"+n+":</label>");var r=$("<div></div>");r.addClass("input-group date");var i="<input type='text' name='"+e.name+"' class='form-control'"+" data-date-format='"+e.format+"'";if(e.css){i=i.slice(0,-1);i+=" "+e.css+"'"}if(e.placeholder){i+=" placeholder='"+e.placeholder+"'"}if(e.attributes){i+=" "+e.attributes}if(e.regex){i+=" data-regex='"+e.regex+"'"}if(e.required){i+=" required"}i+=" />";var s=$("<span></span>");s.addClass("input-group-addon");s.html('<i class="fa fa-calendar"></i>');r.append(i);r.append(s);t.append(r);return t};var _timeField=function(e){var t=$("<div></div>");t.addClass("form-group");var n=e.label;if(settings.showRequiredAsterisk&&e.required){n+="<span class='required-sign'>*</span>"}t.append("<label class='control-label'>"+n+":</label>");var r=$("<div></div>");r.addClass("input-group time");var i="<input type='text' name='"+e.name+"' class='form-control'";if(e.css){i=i.slice(0,-1);i+=" "+e.css+"'"}if(e.placeholder){i+=" placeholder='"+e.placeholder+"'"}if(e.attributes){i+=" "+e.attributes}if(e.regex){i+=" data-regex='"+e.regex+"'"}if(e.required){i+=" required"}i+=" />";var s=$("<span></span>");s.addClass("input-group-addon");s.html('<i class="fa fa-clock-o"></i>');r.append(i);r.append(s);t.append(r);return t};var _textareaField=function(e){var t=$("<div></div>");t.addClass("form-group");var n=e.label;if(settings.showRequiredAsterisk&&e.required){n+="<span class='required-sign'>*</span>"}t.append("<label class='control-label'>"+n+":</label>");var r="<textarea name='"+e.name+"' class='form-control'";if(e.css){r=r.slice(0,-1);r+=" "+e.css+"'"}if(e.placeholder){r+=" placeholder='"+e.placeholder+"'"}if(e.attributes){r+=" "+e.attributes}if(e.required){r+=" required"}r+="></textarea>";t.append(r);return t};var _wysiwygField=function(e){var t=$("<div></div>");t.addClass("form-group");var n=e.label;t.append("<label class='control-label'>"+n+":</label>");var r="<div name='"+e.name+"' class='form-control wysiwyg'";if(e.css){r=r.slice(0,-1);r+=" "+e.css+"'"}if(e.placeholder){r+=" placeholder='"+e.placeholder+"'"}if(e.attributes){r+=" "+e.attributes}if(e.required){r+=" required"}r+="></div>";t.append(r);return t};var _button=function(e){var t=$("<div></div>");t.addClass("form-group");var n="<button type='button' class='btn btn-default'";if(e.css){n=n.slice(0,-1);n+=" "+e.css+"'"}n+=">"+e.label+"</button>";t.append(n);if(e.clickCB){var r=t.find("button");$(r).on("click",e.clickCB)}return t}};$.fn.TieJS=function(e){return this.each(function(){var t=$(this);if(t.data("tiejs")){return}t.data("tiejs",new TieJS(this,e))})}})
