angular.module("tiejs-ang",["angular.css.injector"]).directive("tiejsForm",["cssInjector",function(e){return{restrict:"E",scope:{formName:"@formName",showRequiredAsterisk:"@showRequiredAsterisk",fields:"=fields",bindings:"=bindings",bindingSource:"=bindingSource",onSubmit:"=onSubmit",submitButtonId:"@submitButtonId",reloadFlag:"=reloadFlag"},template:"<form></form>",link:function(t,n,r){var i=function(e,n){t.bindings.forEach(function(t){var r=t[e.data.name];if(r)n.push(r)})};var s=function(t,n,r){var s=new Array;var o=new Array;var u=new Array;var a=new Array;var f=function(e){e.forEach(function(e){switch(e.type){case"color":i(e,s);break;case"date":i(e,o);break;case"time":i(e,u);break;case"wysiwyg":i(e,a);break}})};var l={showRequiredAsterisk:t.showRequiredAsterisk,formName:t.formName,bindingSource:t.bindingSource,onSubmit:t.onSubmit};var c=n.find("form");c.TieJS(l);var h=c.data("tiejs");t.fields.forEach(function(e){if(e.fieldData){if(e.fieldType==="field"){h.addFields(e.fieldData)}else if(e.fieldType==="column"){h.addColumns(e.fieldData)}else{if(console)console.log("tiejs-directive: unknown type of field (only type -field- and -column- are allowed)")}f(e.fieldData)}});h.addBindings(t.bindings);var p=new Array;if(s.length>0){var d=c.find(".color");for(var v=0;v<s.length;v++){var m=$(d[v]).colorpicker({color:"#"+t.bindingSource[s[v]]});m.on("changeColor",function(e){var n=e.color.toHex();t.bindingSource[s[v]]=n.replace("#","")});p.push(m)}}var g=new Array;if(o.length>0){var y=c.find(".date");for(var v=0;v<y.length;v++){var b=$(y[v]).datetimepicker({language:"de",pickTime:false,showToday:true,daysOfWeekDisabled:[0]});g.push(b)}}var w=new Array;if(u.length>0){var E=c.find(".time");for(var v=0;v<E.length;v++){var S=$(E[v]).clockpicker({placement:"bottom",align:"left",autoclose:"true"});w.push(b)}}var x=new Array;if(a.length>0){var T=c.find(".wysiwyg");for(var v=0;v<T.length;v++){var N=$(T[v]).wysiwyg();$(T[v]).css("overflow","scroll");$(T[v]).css("min-height","400px");x.push(N)}}if(e){if(p.length>0){e.add("/public/js/lib/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css")}if(g.length>0){e.add("/public/js/lib/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css")}if(w.length>0){e.add("/public/js/lib/clockpicker/dist/bootstrap-clockpicker.min.css")}}$("#"+t.submitButtonId).on("click",function(){c.trigger("submit")})};s(t,n,r);if(t.reloadFlag!="undefined"){t.$watch("reloadFlag",function(){$(n).find("form").children().remove();s(t,n,r)})}}}}])
